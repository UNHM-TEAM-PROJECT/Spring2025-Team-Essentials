<!--
File: Index.html
Authors: 
Contributors: SAI SHIVA
Date: 
-->

<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NECHE Compliance Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Global variables for consistent styling throughout the application */
        :root {
            --unh-blue: #003591;
            --unh-white: #ffffff;
            --chat-bg: rgba(248, 249, 250, 0.95);
            --message-bg: rgba(233, 236, 239, 0.9);
            --input-bg: rgba(248, 249, 250, 0.95);
            --btn-color: #ebf0f9;
            --btn-hover: #9662be;
            --btn-text: #ffffff;
            --border-radius: 0;
            --unh-black: #403a3a;
        }
        /* Ensure the application occupies the full viewport with no extra margins or scrollbars */

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body {
            background-image: url('../templates/chatbot-bg.png');
            background-size: 600px; /* Adjust the image size */
            background-repeat: no-repeat;
            background-position: center center;
        }


        body {
            background-image: url('../templates/chatbot-bg.png');
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        /* A transparent overlay to darken the background image and blur it slightly for readability */

        .page-container {
            height: 100vh;
            width: 100vw;
            backdrop-filter: blur(5px);
            background: rgba(0, 0, 0, 0.3);
        }
        /* Main chat container with full height and blurred background */

        .chat-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 0;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
            margin: 0;
        }
            /* Chat header with a blue gradient background and centered content */

        .chat-header {
            background: linear-gradient(135deg, var(--unh-blue) 0%, #003591 100%);
            color: var(--unh-white);
            padding: 1rem;
            display: flex;
            justify-content: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            height: 80px;
        }

        /* Flex container for header logo and title */
        .header-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Logo styling */
        .chat-header img {
            height: 60px;
            width: auto;
            object-fit: contain;
        }
        
        /* Header title styling */
        .chat-header-title {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
         /* Message container with scrolling and background styling */

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background-color: transparent;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)),
                url('/Users/bubby/TeamGulliver/static/logo.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        /* Container for edit icon positioned at bottom-right */

       .edit-icon-container {
            position: absolute; /* Position it absolutely within the message container */
            bottom: 40px; /* Place it at the bottom */
            right: -2px; /* Align it to the right */
            z-index: 1; /* Ensure it appears above content */
            display: flex;
            align-items: center;
            justify-content: center;
        }
         /* Styling for clickable edit icon */

        .edit-icon {
            font-size: 16px; /* Adjust size */
            color: var(--unh-black); /* Default color for the edit icon */
            cursor: pointer; /* Make it clickable */
            transition: color 0.2s ease-in-out; /* Smooth hover effect */
        }
        
        /* Hover effect for the edit icon */
        .edit-icon:hover {
            color: var(--unh-blue); /* Highlight color on hover */
        }
        
        /* Chat message styling with animation and shadows */
        .message {
            position: relative;
            margin-bottom: 1.5rem;
            padding: 1rem;
            border-radius: 1rem;
            max-width: 75%;
            animation: fadeIn 0.3s ease-in-out;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            word-wrap: break-word;
        }
        
        /* Fade-in animation for new messages */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Styling for user messages aligned to the right */
        .user-message {
            background-color: rgba(255, 255, 255, 0.9);
            color: #212529;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
            text-align: left;
        }
        
         /* Styling for assistant messages aligned to the left */
        .assistant-message {
            background-color: rgba(255, 255, 255, 0.9);
            color: #212529;
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
            backdrop-filter: blur(5px);
            text-align: left;
        }
        
        /* Small circular avatar next to messages */
        .message-avatar {
            width: 32px;
            height: 32px;
            position: absolute;
            bottom: -16px;
            border-radius: 50%;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }
        /* Container for the input and buttons */
        .message-content {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Push buttons to the right */
            gap: 10px; /* Spacing between elements */
        }
        
        /* Style for the input field */
        .edit-input {
            flex-grow: 1; /* Make input take available space */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        
        /* Action buttons (Cancel and Send) */
        .action-buttons {
            display: flex;
            gap: 8px; /* Space between buttons */
        }
        
        .cancel-button,
        .send-button {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            line-height: 1.2;
        }
        
        .cancel-button {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .send-button {
            background-color: #003591; /* Updated color */
            color: #fff; /* Keep the text white for contrast */
        }
        
        /* Optional hover effect */
        .send-button:hover {
            background-color: #001F5C; /* A slightly darker shade for hover */
        }
        
        
        /* Hover effects for buttons */
        .cancel-button:hover {
            background-color: #e0e0e0;
        }

        /* Avatar for user messages, positioned to the right and styled with blue background and white icon color */
        .user-message .message-avatar {
            right: -16px;
            background-color: var(--unh-blue);
            color: white;
        }
        
        /* Avatar for assistant messages, positioned to the left and styled with blue background and white icon color */
        .assistant-message .message-avatar {
            left: -16px;
            background-color: var(--unh-blue);
            color: white;
        }
        
        /* Container for the input field and send button, centered horizontally with rounded bottom corners */
        .input-area {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            background-color: #e6e6fa;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
        }
        
        /* Group for input field and send button, styled with rounded corners and shadow */
        .input-group {
            background-color: var(--unh-white);
            border-radius: 2rem;
            padding: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Text input field styling, with padding and transparent background */
        #user-input {
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            background: transparent;
        }

        /* Remove shadow on focus for a cleaner look */
        #user-input:focus {
            box-shadow: none;
        }
        
        /* Send button styling, circular with blue background, centered icon, and hover effect */
        #send-button {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: #003591; 
            color: var(--btn-text);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            margin-right: 0.5rem;
        }
        #uploadButton {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: #003591; 
            color: var(--btn-text);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            margin-right: 0.5rem;
        }
        
        /* Hover effect for send button with slight scale animation */
        #send-button:hover {
            background-color: #003591;
            transform: scale(1.05);
        }

        /* Edit button styling, positioned at the top-right of its container with a semi-transparent background */
        .edit-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--unh-black);
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        /* Hover effect for edit button with increased background opacity */
        .edit-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        /* Custom Scrollbar */
        .chat-history::-webkit-scrollbar {
            width: 8px;
        }

        .chat-history::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        .chat-history::-webkit-scrollbar-thumb {
            background: rgba(0, 53, 145, 0.5);
            border-radius: 4px;
        }

        .chat-history::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 53, 145, 0.7);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            font-size: 1rem;
            color: #666;
            margin-top: 10px;
        }

        .typing-indicator .dot {
            width: 8px;
            height: 8px;
            background-color: #666;
            border-radius: 50%;
            margin: 0 2px;
            animation: blink 1s infinite alternate;
        }

        .typing-indicator .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes blink {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        @media (max-width: 768px) {
            .chat-container {
                margin: 0;
                border-radius: 0;
            }

            .message {
                max-width: 85%;
            }

            .chat-header {
                padding: 0.75rem;
                height: 70px;
            }

            .chat-header img {
                height: 60px;
            }

            .chat-header-title {
                font-size: 1.2rem;
            }
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        /* Container */
        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        /* Drag & Drop Upload Box */
        .upload-area {
            border: 2px dashed #003591;
            padding: 30px;
            cursor: pointer;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 20px;
            background-color: #eaf4ff;
            transition: background 0.3s ease;
        }

        .upload-area:hover {
            background: #d6ebff;
        }

        .upload-area.dragover {
            background: #c2e0ff;
            border-color: #003591;
        }

        /* Hidden Input File */
        #fileInput {
            display: none;
        }

        /* File Name Display */
        .file-info {
            margin-top: 10px;
            font-size: 16px;
            color: #003591;
        }
/* Button Container */
.button-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
}

/* Modern Button Styles */
.modern-btn {
    background: linear-gradient(135deg, #003591, #003591);
    color: white;
    font-size: 16px;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
}

/* Zoom-In Effect on Hover */
.modern-btn:hover {
    transform: scale(1.2);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

/* Custom hover styling for specific buttons */
#viewReport:hover,
#downloadReport:hover,
#viewReportBtn:hover,
#downloadReportBtn:hover {
    background: #000 !important;
    color: #fff !important;
    transform: scale(1.2);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

/* Ripple Effect on Click */
.modern-btn:active::after {
    content: "";
    position: absolute;
    width: 200%;
    height: 200%;
    background: rgba(255, 255, 255, 0.3);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    animation: ripple 0.5s ease-out;
}

@keyframes ripple {
    from {
        width: 0;
        height: 0;
        opacity: 1;
    }
    to {
        width: 200%;
        height: 200%;
        opacity: 0;
    }
}

/* Microphone Button Styling */
#mic-button {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background-color: #003591;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    margin-right: 0.5rem;
}

#mic-button:hover {
    background-color: #003591;
    transform: scale(1.1);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

#mic-button i {
    font-size: 18px;
}
/* Ensure the chat-history container doesn't interfere with the table */
.chat-history {
    background: none !important; /* Remove background image and gradient */
    backdrop-filter: none !important; /* Remove blur effect */
}

/* Style for the detailed NECHE report table */
.neche-detailed-report table {
    border-collapse: collapse !important; /* Ensure no gaps between cells */
    width: 100%;
    margin: 0;
    border: 1px solid #ddd; /* Add a border to the table */
}

/* Remove gaps and ensure consistent row styling */
.neche-detailed-report table tr {
    border: none; /* Remove borders between rows */
}

/* Ensure cells have no gaps and proper padding */
.neche-detailed-report table td, 
.neche-detailed-report table th {
    border: 1px solid #ddd; /* Add borders to cells */
    padding: 12px;
    vertical-align: top;
}

/* Remove any overflow constraints on the detailed report */
.neche-detailed-report {
    max-height: none !important; /* Remove height constraint */
    overflow: visible !important; /* Ensure no scrolling */
}
/* Ensure the chat-history container allows full height for all content */
.chat-history {
    overflow-y: auto !important; /* Allow scrolling */
    max-height: none !important; /* Remove any height constraint */
    display: flex !important; /* Ensure flex layout */
    flex-direction: column !important; /* Stack children vertically */
    flex-shrink: 0 !important; /* Prevent shrinking */
}

/* Set a fixed height for the scrollWrapper div and enable scrollbar */
.scroll-wrapper {
    max-height: 300px !important; /* Set a fixed height for the three-column table */
    min-height: 150px !important; /* Ensure it doesn't shrink below this height */
    overflow-y: auto !important; /* Enable vertical scrollbar */
    width: 100% !important; /* Ensure full width */
    flex-shrink: 0 !important; /* Prevent shrinking */
    border: 1px solid #ddd !important; /* Ensure consistent border */
    margin-top: 20px !important; /* Consistent margin */
    margin-bottom: 20px !important; /* Consistent margin */
    padding: 10px !important; /* Consistent padding */
    background-color: white !important; /* Consistent background */
}

/* Custom scrollbar styling for the three-column table */
.scroll-wrapper::-webkit-scrollbar {
    width: 8px;
}

.scroll-wrapper::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
}

.scroll-wrapper::-webkit-scrollbar-thumb {
    background: rgba(0, 53, 145, 0.5);
    border-radius: 4px;
}

.scroll-wrapper::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 53, 145, 0.7);
}

/* Ensure the table inside scrollWrapper takes full width and doesn't shrink */
.scroll-wrapper table {
    width: 100% !important;
    border-collapse: collapse !important;
}

/* Ensure table cells have proper borders and padding */
.scroll-wrapper table td,
.scroll-wrapper table th {
    border: 1px solid #ddd;
    padding: 12px;
    vertical-align: top;
}

/* Ensure the detailed report table does not have a scrollbar */
.neche-detailed-report {
    max-height: none !important; /* Remove height constraint */
    overflow: visible !important; /* Ensure no scrolling */
    width: 100% !important; /* Ensure full width */
    flex-shrink: 0 !important; /* Prevent shrinking */
}

/* Remove any unwanted borders or margins that might cause the horizontal line */
.scroll-wrapper + div {
    margin-top: 0 !important; /* Remove extra margin that might cause the line */
    border-top: none !important; /* Remove any top border */
}

        
    </style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="page-container">
        <div class="container-fluid h-100 p-0">
            <div class="row h-100 m-0">
                <div class="col-12 p-0">
                    <div class="chat-container">
                        <div class="chat-header">
                            <div class="header-content">
                                <h1 class="chat-header-title">NECHE Syllabus Assistant
 </h1>
                            <!-- Additional Logo -->
                        </div>
                    </div>
                    
                        <div class="chat-history" id="chat-history">
                            <!-- Chat messages will be inserted here -->
                        </div>
                        <div class="input-area">
                            <div class="input-group">
                                <button id="uploadButton" class="plus-icon">+</button>
                                <input type="file" id="fileInput" accept=".pdf, .docx, .zip" multiple>
                                
                                <!-- Microphone Button for Voice Input -->
                                <button id="mic-button" class="btn btn-primary">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                
                                <input type="text" id="user-input" class="form-control" placeholder="Type your text here...">
                                <button id="send-button" class="btn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h2 style="text-align: center; font-weight: bold; margin-bottom: 20px;">NECHE Requirement List</h2>

    <div id="reportButtons" style="display: none; text-align: center; margin-top: 20px;">
        <button id="viewReport" class="btn btn-primary">View Report</button>
        <button id="downloadReport" class="btn btn-success">Download Report</button>
    </div>
    <table style="width: 100%; border-collapse: collapse; font-size: 16px; text-align: left; background: white; box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1); border-radius: 8px; overflow: hidden;">
        <thead>
            <tr style="background-color: #003591; color: white; text-align: center;">
                <th style="padding: 15px; border: 1px solid #ddd; width: 40%;">Syllabus Items</th>
                <th style="padding: 15px; border: 1px solid #ddd; width: 60%;">Syllabus Details</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Instructor Name</td>
                <td style="padding: 14px; border: 1px solid #ddd;">Phillip Deen</td>
            </tr>
            
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Title or Rank</td>
                <td style="padding: 14px; border: 1px solid #ddd;">Senior Lecturer of Philosophy & Humanities</td>
            </tr>
    
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Department or Program Affiliation</td>
                <td style="padding: 14px; border: 1px solid #ddd; color: red; font-weight: bold;">Not Found</td>
            </tr>
    
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Preferred Contact Method</td>
                <td style="padding: 14px; border: 1px solid #ddd;">E-mail</td>
            </tr>
    
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Professor's Email Address</td>
                <td style="padding: 14px; border: 1px solid #ddd;">phillip.deen@unh.edu</td>
            </tr>
    
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Professor's Phone Number</td>
                <td style="padding: 14px; border: 1px solid #ddd; color: red; font-weight: bold;">Not Found</td>
            </tr>
    
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Office Address</td>
                <td style="padding: 14px; border: 1px solid #ddd;">431</td>
            </tr>
    
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Office Hours</td>
                <td style="padding: 14px; border: 1px solid #ddd;">Tuesdays and Thursdays before 10:00 or after class at 3:00</td>
            </tr>
    
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Location (Physical or Remote)</td>
                <td style="padding: 14px; border: 1px solid #ddd;">Classroom 345</td>
            </tr>
    
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Course Learning Outcomes</td>
                <td style="padding: 14px; border: 1px solid #ddd;">
                    Gain knowledge about the texts and culture of classical Greece, engage deeply with 
                    general questions of aesthetics, politics, metaphysics, and the nature of a good life, 
                    learn how to read and think critically.
                </td>
            </tr>
    
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Credit Hour Workload</td>
                <td style="padding: 14px; border: 1px solid #ddd; color: red; font-weight: bold;">Not Found</td>
            </tr>
    
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Grading Procedures & Final Grade Scale</td>
                <td style="padding: 14px; border: 1px solid #ddd;">
                    A: 93.3+, A-: 90.0-93.2, B+: 86.6-89.9, B: 83.3-86.5, B-: 80.0-83.2, 
                    C+: 76.6-79.9, C: 73.3-76.5, C-: 70.0-73.2, D+: 66.6-69.9, 
                    D: 63.3-66.5, D-: 60.0-63.2, F: 0-59.9
                </td>
            </tr>
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Course Number and Title</td>
                <td style="padding: 14px; border: 1px solid #ddd;">COMP890 - Advanced Topics in Computer Science</td>
            </tr>
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Number of Credits/Units</td>
                <td style="padding: 14px; border: 1px solid #ddd;">4 Credits</td>
            </tr>
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Modality/Meeting Time and Place</td>
                <td style="padding: 14px; border: 1px solid #ddd;">Hybrid, Mondays and Wednesdays, 2:00 PM - 3:30 PM, Room 210</td>
            </tr>
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Semester/Term (and start/end dates)</td>
                <td style="padding: 14px; border: 1px solid #ddd;">Spring 2025 (January 15 - May 10)</td>
            </tr>
            
        </tbody>
    </table>
    <!-- Voice Assitant -->
    <div class="page-container">
        <div class="container-fluid h-100 p-0">
            <div class="row h-100 m-0">
                <div class="col-12 p-0">
                    <div class="chat-container">
                        <div class="chat-header">
                            <h1 class="chat-header-title">NECHE Syllabus Assistant</h1>
                        </div>
                        <div class="chat-history" id="chat-history">
                            <!-- Chat messages will be inserted here -->
                        </div>
                        <div class="input-area">
                            <div class="input-group">
                                <!-- Microphone Button for Voice Input -->
                                <button id="mic-button" class="btn btn-primary">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <input type="text" id="user-input" class="form-control" placeholder="Type your text here...">
                                <button id="send-button" class="btn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Report Modal -->
    <div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportModalLabel">Extracted NECHE Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="reportContent">
                    <p>No report available.</p>
                </div>
            </div>
        </div>
    </div>
           <!-- Drag & Drop Upload Box -->
           <div class="upload-area" id="uploadArea">
            <p>Drag & Drop your syllabus file here or <span style="color:#003591; font-weight:bold;">Click to Upload</span></p>
            <input type="file" id="fileInput" accept=".pdf, .docx">
            <p class="file-info" id="fileInfo">No file chosen</p>
        </div>

        <!-- Buttons -->
        <div class="button-container">
            <button id="uploadBtn" class="modern-btn">Upload File</button>
            <button id="viewReportBtn" class="modern-btn">View Report</button>
            <button id="downloadReportBtn" class="modern-btn">Download Report</button>
        </div>
    </div>
    background-color: #2a0fa6;
}
#fileInput {
    display: none;
}
.modern-btn {
    background-color: #3a17d8;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: background-color 0.3s;
}
.modern-btn:hover {
    background-color: #2a0fa6;
}
.scroll-wrapper {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: 5px;
}
.table th, .table td {
    vertical-align: middle;
}
@media (max-width: 768px) {
    .chat-container {
        width: 95%;
        height: 90vh;
    }
    .chat-header {
        font-size: 1.2rem;
    }
    #user-input {
        font-size: 0.9rem;
    }
    #send-button, #uploadButton, #mic-button {
        padding: 8px 12px;
        font-size: 0.9rem;
    }
}
</style>
</head>
<body>
<div class="chat-container">
<div class="chat-header">NECHE Compliance Assistant</div>
<div id="chat-history"></div>
<div class="chat-input">
    <input type="text" id="user-input" placeholder="Type your message...">
    <button id="send-button">Send</button>
    <input type="file" id="fileInput" accept=".pdf,.docx,.zip">
    <button id="uploadButton">Upload</button>
    <button id="mic-button"><i class="fas fa-microphone"></i></button>
</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const chatHistory = document.getElementById("chat-history");
    const userInput = document.getElementById("user-input");
    const sendButton = document.getElementById("send-button");
    const fileInput = document.getElementById("fileInput");
    const uploadButton = document.getElementById("uploadButton");
    const micButton = document.getElementById("mic-button");
    console.log("jsPDF loaded:", !!window.jspdf);
console.log("jspdf-autotable loaded:", !!window.jspdfAutoTable);

    let latestReportData = null;
    let allResults = [];

    function displayWelcomeMessage() {
        addHTMLMessage("Welcome! I can assist with NECHE compliance. How can I help you today?", false);
    }
    window.addEventListener("load", displayWelcomeMessage);

    function addHTMLMessage(htmlContent, isUser) {
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("message", isUser ? "user-message" : "assistant-message");

        const chatIcon = document.createElement("div");
        chatIcon.classList.add("message-avatar");
        chatIcon.innerHTML = isUser ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';

        const messageContent = document.createElement("div");
        messageContent.classList.add("message-content");
        messageContent.innerHTML = htmlContent;

        messageDiv.appendChild(chatIcon);
        messageDiv.appendChild(messageContent);

        chatHistory.appendChild(messageDiv);
        chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    sendButton.addEventListener("click", handleSend);
    userInput.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            event.preventDefault();
            handleSend();
        }
    });

    micButton.addEventListener("click", handleVoiceInput);

    function handleSend() {
        const message = userInput.value.trim();
        if (!message) return;

        addHTMLMessage(message, true);
        userInput.value = "";

        fetch("/ask", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message }),
        })
        .then(response => response.json())
        .then(data => {
            const userMessage = message.toLowerCase().trim();
            const casualGreetings = {
                "hi": "Hey! This is NECHE Compliance Assistant. How can I help you?",
                "hello": "Hello! How can I assist you today?",
                "hey": "Hey there! Need help with NECHE syllabus compliance?",
                "what's up": "Not much, just assisting with NECHE compliance. What’s up with you?",
                "how are you": "I'm great! Thanks for asking. How can I help you?"
            };

            if (casualGreetings[userMessage]) {
                addHTMLMessage(casualGreetings[userMessage], false);
            } else {
                addHTMLMessage(data.response, false);
            }
        })
        .catch(() => addHTMLMessage("⚠️ Error: Unable to communicate with the server.", false));
    }

    function handleVoiceInput() {
        if (!('webkitSpeechRecognition' in window)) {
            alert("Sorry, your browser does not support voice recognition.");
            return;
        }

        const recognition = new webkitSpeechRecognition();
        recognition.lang = "en-US";
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onstart = () => {
            addHTMLMessage("Listening...", false);
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            userInput.value = transcript;
            handleSend();
        };

        recognition.onerror = (event) => {
            addHTMLMessage("⚠️ Voice recognition error. Please try again.", false);
        };

        recognition.onend = () => {
            console.log("Voice recognition ended.");
        };

        recognition.start();
    }

    uploadButton.addEventListener("click", function () {
        fileInput.click();
    });

    fileInput.addEventListener("change", function (e) {
        const files = e.target.files;
        if (!files.length) return;

        const file = files[0];
        if (
            file &&
            (
                file.type === "application/pdf" ||
                file.name.endsWith(".docx") ||
                file.name.endsWith(".zip")
            )
        ) {
            addHTMLMessage(`<strong>Uploaded:</strong> ${file.name}`, true);
            handleFileUpload(file);
        } else {
            addHTMLMessage("Only PDF, DOCX, or ZIP files are supported.", false);
            fileInput.value = "";
        }
    });

    function handleFileUpload(file) {
        const formData = new FormData();
        formData.append("file", file);

        addHTMLMessage("Processing uploaded syllabus for NECHE compliance check...", false);

        fetch("/upload", {
            method: "POST",
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                allResults = data.results || [{ filename: file.name, extracted_information: data.extracted_information, compliance_check: data.compliance_check }];
                latestReportData = data.extracted_information || {};

                const scrollWrapper = document.createElement("div");
                scrollWrapper.className = "scroll-wrapper";
                scrollWrapper.style.border = "1px solid #ddd";
                scrollWrapper.style.marginTop = "20px";
                scrollWrapper.style.marginBottom = "20px";
                scrollWrapper.style.padding = "10px";
                scrollWrapper.style.backgroundColor = "white";

                const table = document.createElement("table");
                table.className = "table table-bordered";
                table.style.marginBottom = "0";
                table.style.borderCollapse = "collapse";

                const thead = document.createElement("thead");
                thead.innerHTML = `
                    <tr style="background-color: #3a17d8; color: white; text-align: center;">
                        <th style="padding: 12px; width: 40%; border: 1px solid #ddd;">Name of the Document</th>
                        <th style="padding: 12px; width: 20%; border: 1px solid #ddd;">Syllabus Compliance</th>
                        <th style="padding: 12px; width: 40%; border: 1px solid #ddd;">Report</th>
                    </tr>`;
                table.appendChild(thead);

                const tbody = document.createElement("tbody");

                allResults.forEach((result, index) => {
                    const filename = result.filename || `File_${index + 1}`;
                    const passFail = result.compliance_check.includes("Compliant") ? "Pass" : "Fail";
                    const reportData = result.extracted_information || {};

                    let courseNumberAndTitle = reportData["Course Number and Title"] || "Not Found";
                    let professorName = reportData["Instructor Name"] || "Not Found";
                    let courseNumber = "";
                    let courseTitle = "";
                    if (courseNumberAndTitle !== "Not Found") {
                        const parts = courseNumberAndTitle.split(" ");
                        if (parts.length >= 2) {
                            const potentialCourseNumber = parts[0] + (parts[1].match(/^\d+$/) ? " " + parts[1] : "");
                            const courseNumberMatch = potentialCourseNumber.match(/^[A-Z]+ \d+$/);
                            if (courseNumberMatch) {
                                courseNumber = potentialCourseNumber;
                                courseTitle = parts.slice(2).join(" ").trim();
                            } else {
                                courseTitle = courseNumberAndTitle.trim();
                            }
                        } else {
                            courseTitle = courseNumberAndTitle.trim();
                        }
                    }

                    let courseDetails = [];
                    if (courseNumber) courseDetails.push(`<span style="font-weight: bold;">Course Number:</span> ${courseNumber}`);
                    if (courseTitle) courseDetails.push(`<span style="font-weight: bold;">Course Title:</span> ${courseTitle}`);
                    if (professorName !== "Not Found") courseDetails.push(`<span style="font-weight: bold;">Professor:</span> ${professorName}`);

                    let statusHeading = courseDetails.length > 0 ? `
                        <div style="margin-bottom: 10px; padding: 8px; background-color: #f0f0f0; border-radius: 4px;">
                            ${courseDetails.join("<br>")}
                        </div>` : "";

                    let formattedComplianceMessage = result.compliance_check || "Compliance status not available.";
                    const urlRegex = /(https?:\/\/[^\s]+)/g;
                    formattedComplianceMessage = formattedComplianceMessage.replace(urlRegex, url => {
                        return `<a href="${url}" target="_blank" style="color: #1a73e8; text-decoration: underline; word-break: break-all;">${url}</a>`;
                    });

                    const fullStatusMessage = `
                        <div style="line-height: 1.5;">
                            ${statusHeading}
                            <div style="margin-top: 10px;">
                                ${formattedComplianceMessage}
                            </div>
                        </div>`;

                    const row = document.createElement("tr");

                    const nameCell = document.createElement("td");
                    nameCell.style.padding = "10px";
                    nameCell.style.border = "1px solid #ddd";
                    nameCell.innerHTML = `<strong>${filename}</strong>`;
                    row.appendChild(nameCell);

                    const statusCell = document.createElement("td");
                    statusCell.style.padding = "10px";
                    statusCell.style.textAlign = "center";
                    statusCell.style.border = "1px solid #ddd";
                    statusCell.innerHTML = `<strong>${passFail}</strong>`;
                    row.appendChild(statusCell);

                    const buttonCell = document.createElement("td");
                    buttonCell.style.padding = "10px";
                    buttonCell.style.textAlign = "center";
                    buttonCell.style.border = "1px solid #ddd";

                    const viewBtn = createStyledButton("View", "modern-btn", () => showReportModal(reportData));
                    const downloadBtn = createStyledButton("Download", "modern-btn", () => downloadSingleReport(reportData, filename));
                    const statusBtn = createStyledButton("Status", "modern-btn", () => {
    showCompliancePopupClean(reportData, filename, result.compliance_check);
});
                    viewBtn.style.marginRight = "8px";
                    downloadBtn.style.marginRight = "8px";

                    buttonCell.appendChild(viewBtn);
                    buttonCell.appendChild(downloadBtn);
                    buttonCell.appendChild(statusBtn);
                    row.appendChild(buttonCell);

                    tbody.appendChild(row);
                });

                table.appendChild(tbody);
                scrollWrapper.appendChild(table);
                chatHistory.appendChild(scrollWrapper);

                if (allResults.length > 1) {
                    const allBtnWrapper = document.createElement("div");
                    allBtnWrapper.style.textAlign = "center";
                    allBtnWrapper.style.marginTop = "20px";

                    const allReportsBtn = createStyledButton("Download All Reports", "modern-btn", () => downloadAllReports(allResults));
                    allBtnWrapper.appendChild(allReportsBtn);
                    chatHistory.appendChild(allBtnWrapper);
                }
            } else {
                throw new Error(`Upload failed: ${data.error}`);
            }
        })
        .catch(error => addHTMLMessage(`⚠️ ${error.message}`, false));
    }

    function createStyledButton(text, classes, clickHandler) {
        const button = document.createElement("button");
        button.textContent = text;
        button.className = `${classes} modern-btn`;
        button.style.margin = "10px";
        button.addEventListener("click", clickHandler);
        return button;
    }

    function downloadSingleReport(data, filename) {
    const { jsPDF } = window.jspdf;
    if (!jsPDF) {
        console.error("jsPDF is not loaded.");
        addHTMLMessage("⚠️ Error: jsPDF library not loaded.", false);
        return;
    }
    if (!window.jspdfAutoTable) {
        console.error("jspdf-autotable is not loaded.");
        addHTMLMessage("⚠️ Error: jspdf-autotable library not loaded.", false);
        return;
    }

    const doc = new jsPDF();

    const requiredFields = [
        "Instructor Name", "Title or Rank", "Department or Program Affiliation", "Preferred Contact Method",
        "Email Address", "Phone Number", "Office Address", "Office Hours", "Location (Physical or Remote)",
        "Course SLOs", "Credit Hour Workload", "Assignments & Delivery", "Grading Procedures & Final Grade Scale",
        "Assignment Deadlines & Policies"
    ];

    const minimumFields = [
        "Modality/Meeting Time and Place", "Semester/Term (and start/end dates)", "Department/Program",
        "Format (e.g., lecture plus lab/discussion etc.)", "Course Description (minimum course catalog description)",
        "Sequence of Course Topics and Important Dates", "Required/Recommended Textbook (or other source for course reference information)",
        "Other Required/Recommended Materials (e.g., software, clicker remote, etc.)", "Technical Requirements",
        "Attendance", "Academic Integrity/Plagiarism/AI"
    ];

    const optionalFields = [
        "Simultaneous 700/800 course designation (Graduate vs. Undergraduate)",
        "Names and contact information for teaching assistants",
        "Sensitive course content",
        "Additional information as needed for program accreditation (and other program requirements)"
    ];

    const allFields = [...requiredFields, ...minimumFields, ...optionalFields];
    const tableColumn = ["Syllabus Items", "Syllabus Details"];
    const tableRows = [];

    allFields.forEach(field => {
        const value = data[field] || "Not Found";
        const isOptional = optionalFields.includes(field);

        if (isOptional && value === "Not Found") return;

        let displayField = field;
        if (requiredFields.includes(field)) {
            displayField = `**${field}**`;
        } else if (optionalFields.includes(field)) {
            displayField = `***${field}***`;
        }

        const displayValue = value === "Not Found" ? "Not Found" : value;
        tableRows.push([displayField, displayValue]);
    });

    let title = "NECHE Compliance Report";
    const course = data["Course Number and Title"];
    const professor = data["Instructor Name"];

    const headingParts = [];
    if (course && course !== "Not Found") headingParts.push(course);
    if (professor && professor !== "Not Found") headingParts.push(`by Professor ${professor}`);

    if (headingParts.length > 0) title += " – " + headingParts.join(" ");

    const pageWidth = doc.internal.pageSize.getWidth();
    const textWidth = doc.getTextWidth(title);
    doc.setFontSize(16);
    doc.text(title, (pageWidth - textWidth) / 2, 20);

    doc.autoTable({
        startY: 30,
        head: [tableColumn],
        body: tableRows,
        theme: "grid",
        headStyles: {
            fillColor: [58, 23, 216],
            textColor: [255, 255, 255],
            fontSize: 10,
        },
        styles: {
            fontSize: 10,
            cellPadding: 4,
        },
        didParseCell: function (data) {
            if (data.column.index === 0) {
                let text = data.cell.text[0];
                if (text.startsWith("***") && text.endsWith("***")) {
                    data.cell.text[0] = text.slice(3, -3);
                    data.cell.styles.fontStyle = "italic";
                } else if (text.startsWith("**") && text.endsWith("**")) {
                    data.cell.text[0] = text.slice(2, -2);
                    data.cell.styles.fontStyle = "bold";
                }
            }

            if (data.column.index === 1 && data.cell.text[0] === "Not Found") {
                data.cell.styles.textColor = [255, 0, 0];
                data.cell.styles.fontStyle = "bold";
            }
        }
    });

    doc.save(`${filename}_NECHE_Report.pdf`);
}
    function showReportModal(data) {
        const requiredFields = [
            "Instructor Name", "Title or Rank", "Department or Program Affiliation", "Preferred Contact Method",
            "Email Address", "Phone Number", "Office Address", "Office Hours", "Location (Physical or Remote)",
            "Course SLOs", "Credit Hour Workload", "Assignments & Delivery", "Grading Procedures & Final Grade Scale",
            "Assignment Deadlines & Policies"
        ];

        const minimumFields = [
            "Modality/Meeting Time and Place", "Semester/Term (and start/end dates)", "Department/Program",
            "Format (e.g., lecture plus lab/discussion etc.)", "Course Description (minimum course catalog description)",
            "Sequence of Course Topics and Important Dates", "Required/Recommended Textbook (or other source for course reference information)",
            "Other Required/Recommended Materials (e.g., software, clicker remote, etc.)", "Technical Requirements",
            "Attendance", "Academic Integrity/Plagiarism/AI"
        ];

        const optionalFields = [
            "Simultaneous 700/800 course designation (Graduate vs. Undergraduate)",
            "Names and contact information for teaching assistants",
            "Sensitive course content",
            "Additional information as needed for program accreditation (and other program requirements)"
        ];

        const allFields = [...requiredFields, ...minimumFields, ...optionalFields];

        let html = `<html><head>
            <title>NECHE Report</title>
            <style>
                body { font-family: "Segoe UI", sans-serif; padding: 20px; background: #f9f9fb; color: #333; max-width: 1000px; margin: auto; }
                h2 { font-size: 20px; text-align: center; margin-bottom: 20px; font-weight: 600; color: #2a2a2a; }
                table { width: 100%; border-collapse: collapse; background: white; border: 1px solid #ccc; font-size: 14px; }
                th, td { padding: 8px 10px; border: 1px solid #ddd; vertical-align: top; text-align: left; }
                th { background-color: #3a17d8; color: white; font-weight: 600; }
                .download-btn { margin-top: 20px; display: block; width: fit-content; margin-left: auto; margin-right: auto; background-color: #3a17d8; color: white; padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px; transition: 0.3s ease; }
                .download-btn:hover { background-color: #2a0fa6; }
            </style>
        </head><body>`;

        let courseTitleRaw = data["Course Number and Title"];
        let instructor = data["Instructor Name"];
        let headingParts = [];

        if (courseTitleRaw && courseTitleRaw !== "Not Found") headingParts.push(courseTitleRaw);
        if (instructor && instructor !== "Not Found") headingParts.push(`by Professor ${instructor}`);

        let headingText = "NECHE Compliance Report";
        if (headingParts.length) headingText += " – " + headingParts.join(" ");

        html += `<h2>${headingText}</h2>`;
        html += `<table><thead><tr><th>Syllabus Items</th><th>Syllabus Details</th></tr></thead><tbody>`;

        allFields.forEach((field) => {
            const value = data[field] || "Not Found";
            const isOptional = optionalFields.includes(field);

            if (isOptional && value === "Not Found") return;

            let formattedField = field;
            if (requiredFields.includes(field)) {
                formattedField = `<strong>${field}</strong>`;
            } else if (optionalFields.includes(field)) {
                formattedField = `<em><strong>${field}</strong></em>`;
            }

            const displayValue = value === "Not Found" ? `<span style="color: red; font-weight: bold;">Not Found</span>` : value;

            html += `<tr><td>${formattedField}</td><td>${displayValue}</td></tr>`;
        });

        html += `</tbody></table>`;
        const safeData = encodeURIComponent(JSON.stringify(data));
        html += `<button class="download-btn" onclick="window.opener.downloadSingleReport(JSON.parse(decodeURIComponent('${safeData}')), '${data["Course Number and Title"] || "Report"}')">Download PDF</button>`;
        html += `</body></html>`;

        const newWin = window.open("", "_blank");
        newWin.document.open();
        newWin.document.write(html);
        newWin.document.close();
    }

    function downloadAllReports(results) {
        const { jsPDF } = window.jspdf;
        const zip = new JSZip();

        if (!jsPDF || !JSZip || !saveAs) {
            console.error("Required libraries (jsPDF, JSZip, or FileSaver) are not loaded.");
            addHTMLMessage("⚠️ Error: Required libraries not loaded.", false);
            return;
        }

        results.forEach((result, index) => {
            const doc = new jsPDF();
            const filename = result.filename || `File_${index + 1}`;
            const reportData = result.extracted_information || {};

            let courseNumberAndTitle = reportData["Course Number and Title"] || "Not Found";
            let professorName = reportData["Instructor Name"] || "Not Found";
            let courseNumber = "";
            let courseTitle = "";
            if (courseNumberAndTitle !== "Not Found") {
                const parts = courseNumberAndTitle.split(" ");
                if (parts.length >= 2) {
                    const potentialCourseNumber = parts[0] + (parts[1].match(/^\d+$/) ? " " + parts[1] : "");
                    const courseNumberMatch = potentialCourseNumber.match(/^[A-Z]+ \d+$/);
                    if (courseNumberMatch) {
                        courseNumber = potentialCourseNumber;
                        courseTitle = parts.slice(2).join(" ").trim();
                    } else {
                        courseTitle = courseNumberAndTitle.trim();
                    }
                } else {
                    courseTitle = courseNumberAndTitle.trim();
                }
            }

            let headingParts = [];
            let coursePart = courseNumber ? `${courseTitle} (${courseNumber})` : courseTitle;
            if (coursePart) headingParts.push(coursePart);
            if (professorName !== "Not Found") headingParts.push(`by Professor ${professorName}`);

            let heading = "NECHE Compliance Report";
            if (headingParts.length > 0) heading += " – " + headingParts.join(" ");

            const pageWidth = doc.internal.pageSize.getWidth();
            const textWidth = doc.getTextWidth(heading);
            doc.setFontSize(16);
            doc.text(heading, (pageWidth - textWidth) / 2, 20);

            const tableColumn = ["Syllabus Items", "Syllabus Details"];
            const tableRows = [];

            const requiredOrder = [
                "Instructor Name", "Title or Rank", "Department or Program Affiliation",
                "Preferred Contact Method", "Email Address", "Phone Number",
                "Office Address", "Office Hours", "Location (Physical or Remote)",
                "Course Learning Outcomes", "Credit Hour Workload", "Coursework Types & Submission Methods",
                "Grading Procedures & Final Grade Scale", "Assignment Deadlines & Policies",
                "Course Description", "Course Format", "Course Topics and Schedule",
                "Sensitive Course Content", "Required/recommended textbook (or other source for course reference information)",
                "Other required/recommended materials (e.g., software, clicker remote, etc.)",
                "Technical Requirements", "Attendance", "Academic integrity/plagiarism/AI",
                "Program Accreditation Info", "Course Number and Title",
                "Number of Credits/Units (include a link to the federal definition of a credit hour)",
                "Modality/Meeting Time and Place", "Semester/Term (and start/end dates)"
            ];

            const formattingMap = {
                "Assignment Deadlines & Policies": "regular",
                "Technical Requirements": "regular",
                "Attendance": "regular",
                "Academic integrity/plagiarism/AI": "regular",
                "Program Accreditation Info": "regular",
                "Sensitive Course Content": "regular",
                "Other required/recommended materials (e.g., software, clicker remote, etc.)": "regular",
                "Course Number and Title": "bold",
                "Number of Credits/Units (include a link to the federal definition of a credit hour)": "bold",
                "Modality/Meeting Time and Place": "bold",
                "Semester/Term (and start/end dates)": "bold",
                "Course Description": "bold",
                "Course Format": "bold",
                "Course Topics and Schedule": "bold",
                "Course Learning Outcomes": "bold",
                "Credit Hour Workload": "bold",
                "Coursework Types & Submission Methods": "bold",
                "Grading Procedures & Final Grade Scale": "bold",
                "Required/recommended textbook (or other source for course reference information)": "bold",
                "Instructor Name": "italic-bold",
                "Title or Rank": "italic-bold",
                "Department or Program Affiliation": "italic-bold",
                "Preferred Contact Method": "italic-bold",
                "Email Address": "italic-bold",
                "Phone Number": "italic-bold",
                "Office Address": "italic-bold",
                "Office Hours": "italic-bold",
                "Location (Physical or Remote)": "italic-bold"
            };

            requiredOrder.forEach(key => {
                const value = reportData[key] || "Not Found";
                const format = formattingMap[key] || "regular";
                if (format === "italic-bold" && value === "Not Found") return;

                let formattedKey = key;
                if (format === "bold") {
                    formattedKey = `**${key}**`;
                } else if (format === "italic-bold") {
                    formattedKey = `***${key}***`;
                }

                const displayValue = value === "Not Found" ? "Not Found" : value;
                tableRows.push([formattedKey, displayValue]);
            });

            doc.autoTable({
                startY: 30,
                head: [tableColumn],
                body: tableRows,
                theme: "grid",
                headStyles: {
                    fillColor: [58, 23, 216],
                    textColor: [255, 255, 255],
                    fontSize: 10,
                    cellPadding: 4,
                },
                columnStyles: {
                    0: { fillColor: [242, 242, 242], cellWidth: 70 },
                    1: { fillColor: [255, 255, 255], cellWidth: 110 },
                },
                styles: {
                    fontSize: 10,
                    cellPadding: 4,
                    textColor: [0, 0, 0],
                },
                didParseCell: function (data) {
                    if (data.column.index === 0) {
                        let text = data.cell.text[0];
                        if (text.startsWith("***") && text.endsWith("***")) {
                            data.cell.text[0] = text.slice(3, -3);
                            data.cell.styles.fontStyle = "italicbold";
                        } else if (text.startsWith("**") && text.endsWith("**")) {
                            data.cell.text[0] = text.slice(2, -2);
                            data.cell.styles.fontStyle = "bold";
                        }
                    }
                    if (data.column.index === 1 && data.cell.text[0] === "Not Found") {
                        data.cell.styles.textColor = [255, 0, 0];
                        data.cell.styles.fontStyle = "bold";
                    }
                },
                didDrawCell: function (data) {
                    doc.setDrawColor(221, 221, 221);
                    doc.setLineWidth(0.1);
                    doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height);
                }
            });

            const pdfBlob = doc.output('blob');
            zip.file(`${filename}_NECHE_Report.pdf`, pdfBlob);
        });

        zip.generateAsync({ type: "blob" }).then(function (content) {
            saveAs(content, "NECHE_Reports.zip");
        });
    }
});
function showCompliancePopupClean(data, filename, complianceStatus) {
    const missingNECHE = [
        "Coursework Types & Submission Methods",
        "Credit Hour Workload",
        "Grading Procedures & Final Grade Scale",
        "Assignment Deadlines & Policies",
        "Course SLOs"
    ].filter(field => !data[field] || data[field] === "Not Found");

    const missingMinimum = [
        "Technical Requirements",
        "Required/Recommended Textbook (or other source for course reference information)",
        "Other Required/Recommended Materials (e.g., software, clicker remote, etc.)",
        "Format (e.g., lecture plus lab/discussion etc.)"
    ].filter(field => !data[field] || data[field] === "Not Found");

    const courseRaw = data["Course Number and Title"] || "Not Found";
    const professor = data["Instructor Name"] || "Not Found";

    // Try to separate number and title
    let courseNumber = "";
    let courseTitle = courseRaw;
    const parts = courseRaw.split(" ");
    if (parts.length >= 2 && /^[A-Z]{2,}\d{2,}/.test(parts[0] + parts[1])) {
        courseNumber = parts[0] + " " + parts[1];
        courseTitle = parts.slice(2).join(" ");
    }

    // Determine compliance status
    const isCompliant = missingNECHE.length === 0 && missingMinimum.length === 0;
    const statusColor = isCompliant ? "green" : "red";
    const statusText = isCompliant ? "Pass" : "Fail";

    const popupOverlay = document.createElement("div");
    popupOverlay.id = "compliance-popup";
    popupOverlay.style.position = "fixed";
    popupOverlay.style.top = "0";
    popupOverlay.style.left = "0";
    popupOverlay.style.width = "100vw";
    popupOverlay.style.height = "100vh";
    popupOverlay.style.backgroundColor = "rgba(0,0,0,0.5)";
    popupOverlay.style.display = "flex";
    popupOverlay.style.justifyContent = "center";
    popupOverlay.style.alignItems = "center";
    popupOverlay.style.zIndex = "9999";

    const popup = document.createElement("div");
    popup.style.background = "#ffffff"; // Light background (white)
    popup.style.borderRadius = "10px";
    popup.style.padding = "25px";
    popup.style.width = "90%";
    popup.style.maxWidth = "650px";
    popup.style.maxHeight = "85vh";
    popup.style.overflowY = "auto";
    popup.style.fontFamily = "Segoe UI, sans-serif";
    popup.style.boxShadow = "0 10px 30px rgba(0,0,0,0.3)";
    popup.style.color = "#000000"; // Default text color to black

    // Create the table for course details and compliance status
    let popupContent = `
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
            <tr>
                <td style="padding: 8px; font-weight: bold; border: 1px solid #ddd;">Course Number</td>
                <td style="padding: 8px; border: 1px solid #ddd;">${courseNumber || "N/A"}</td>
            </tr>
            <tr>
                <td style="padding: 8px; font-weight: bold; border: 1px solid #ddd;">Course Title</td>
                <td style="padding: 8px; border: 1px solid #ddd;">${courseTitle || "N/A"}</td>
            </tr>
            <tr>
                <td style="padding: 8px; font-weight: bold; border: 1px solid #ddd;">Professor</td>
                <td style="padding: 8px; border: 1px solid #ddd;">${professor}</td>
            </tr>
            <tr>
                <td style="padding: 8px; font-weight: bold; border: 1px solid #ddd;">Compliance Status</td>
                <td style="padding: 8px; border: 1px solid #ddd; color: ${statusColor}; font-weight: bold;">${statusText}</td>
            </tr>
        </table>

        <div style="font-weight: bold; color: red; margin-bottom: 20px; text-align: center;">
            ${isCompliant ? "This syllabus is fully NECHE compliant." : "This syllabus is not fully NECHE compliant. Below is the list of missing items."}
        </div>
    `;

    // Add missing NECHE requirements if any
    if (missingNECHE.length > 0) {
        popupContent += `
            <div style="margin-top: 10px; text-align: left;">
                <h5 style="margin-bottom: 10px; color: #000000;">Missing NECHE Requirements</h5>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: #f0f0f0;">
                            <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Item</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${missingNECHE.map(item => `
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd; color: red;">${item}</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
            </div>
        `;
    }

    // Add missing minimum requirements if any
    if (missingMinimum.length > 0) {
        popupContent += `
            <div style="margin-top: 20px; text-align: left;">
                <h5 style="margin-bottom: 10px; color: #000000;">Missing Minimum Requirements</h5>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: #f0f0f0;">
                            <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Item</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${missingMinimum.map(item => `
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd; color: red;">${item}</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
            </div>
        `;
    }

    // Add the Close button
    popupContent += `
        <div style="text-align: center; margin-top: 30px;">
            <button id="closeCompliancePopup" style="background-color: #000000; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">Close</button>
        </div>
    `;

    popup.innerHTML = popupContent;
    popupOverlay.appendChild(popup);
    document.body.appendChild(popupOverlay);

    document.getElementById("closeCompliancePopup").addEventListener("click", () => {
        popupOverlay.remove();
    });
}

</script>
    
</body>
</html>