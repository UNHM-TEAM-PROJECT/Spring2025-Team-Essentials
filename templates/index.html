<!--
File: Index.html
Authors: 
Contributors: SAI SHIVA
Date: 
-->

<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NECHE Compliance Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Global variables for consistent styling throughout the application */
        :root {
            --unh-blue: #3a17d8;
            --unh-white: #ffffff;
            --chat-bg: rgba(248, 249, 250, 0.95);
            --message-bg: rgba(233, 236, 239, 0.9);
            --input-bg: rgba(248, 249, 250, 0.95);
            --btn-color: #ebf0f9;
            --btn-hover: #9662be;
            --btn-text: #ffffff;
            --border-radius: 0;
            --unh-black: #403a3a;
        }
        /* Ensure the application occupies the full viewport with no extra margins or scrollbars */

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body {
            background-image: url('../templates/chatbot-bg.png');
            background-size: 600px; /* Adjust the image size */
            background-repeat: no-repeat;
            background-position: center center;
        }


        body {
            background-image: url('../templates/chatbot-bg.png');
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        /* A transparent overlay to darken the background image and blur it slightly for readability */

        .page-container {
            height: 100vh;
            width: 100vw;
            backdrop-filter: blur(5px);
            background: rgba(0, 0, 0, 0.3);
        }
        /* Main chat container with full height and blurred background */

        .chat-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 0;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
            margin: 0;
        }
            /* Chat header with a blue gradient background and centered content */

        .chat-header {
            background: linear-gradient(135deg, var(--unh-blue) 0%, #2a05cf 100%);
            color: var(--unh-white);
            padding: 1rem;
            display: flex;
            justify-content: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            height: 80px;
        }

        /* Flex container for header logo and title */
        .header-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Logo styling */
        .chat-header img {
            height: 60px;
            width: auto;
            object-fit: contain;
        }
        
        /* Header title styling */
        .chat-header-title {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
         /* Message container with scrolling and background styling */

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background-color: transparent;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)),
                url('/Users/bubby/TeamGulliver/static/logo.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        /* Container for edit icon positioned at bottom-right */

       .edit-icon-container {
            position: absolute; /* Position it absolutely within the message container */
            bottom: 40px; /* Place it at the bottom */
            right: -2px; /* Align it to the right */
            z-index: 1; /* Ensure it appears above content */
            display: flex;
            align-items: center;
            justify-content: center;
        }
         /* Styling for clickable edit icon */

        .edit-icon {
            font-size: 16px; /* Adjust size */
            color: var(--unh-black); /* Default color for the edit icon */
            cursor: pointer; /* Make it clickable */
            transition: color 0.2s ease-in-out; /* Smooth hover effect */
        }
        
        /* Hover effect for the edit icon */
        .edit-icon:hover {
            color: var(--unh-blue); /* Highlight color on hover */
        }
        
        /* Chat message styling with animation and shadows */
        .message {
            position: relative;
            margin-bottom: 1.5rem;
            padding: 1rem;
            border-radius: 1rem;
            max-width: 75%;
            animation: fadeIn 0.3s ease-in-out;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            word-wrap: break-word;
        }
        
        /* Fade-in animation for new messages */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Styling for user messages aligned to the right */
        .user-message {
            background-color: rgba(255, 255, 255, 0.9);
            color: #212529;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
            text-align: left;
        }
        
         /* Styling for assistant messages aligned to the left */
        .assistant-message {
            background-color: rgba(255, 255, 255, 0.9);
            color: #212529;
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
            backdrop-filter: blur(5px);
            text-align: left;
        }
        
        /* Small circular avatar next to messages */
        .message-avatar {
            width: 32px;
            height: 32px;
            position: absolute;
            bottom: -16px;
            border-radius: 50%;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }
        /* Container for the input and buttons */
        .message-content {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Push buttons to the right */
            gap: 10px; /* Spacing between elements */
        }
        
        /* Style for the input field */
        .edit-input {
            flex-grow: 1; /* Make input take available space */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        
        /* Action buttons (Cancel and Send) */
        .action-buttons {
            display: flex;
            gap: 8px; /* Space between buttons */
        }
        
        .cancel-button,
        .send-button {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            line-height: 1.2;
        }
        
        .cancel-button {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .send-button {
            background-color: #002B7D; /* Updated color */
            color: #fff; /* Keep the text white for contrast */
        }
        
        /* Optional hover effect */
        .send-button:hover {
            background-color: #001F5C; /* A slightly darker shade for hover */
        }
        
        
        /* Hover effects for buttons */
        .cancel-button:hover {
            background-color: #e0e0e0;
        }

        /* Avatar for user messages, positioned to the right and styled with blue background and white icon color */
        .user-message .message-avatar {
            right: -16px;
            background-color: var(--unh-blue);
            color: white;
        }
        
        /* Avatar for assistant messages, positioned to the left and styled with blue background and white icon color */
        .assistant-message .message-avatar {
            left: -16px;
            background-color: var(--unh-blue);
            color: white;
        }
        
        /* Container for the input field and send button, centered horizontally with rounded bottom corners */
        .input-area {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            background-color: #e6e6fa;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
        }
        
        /* Group for input field and send button, styled with rounded corners and shadow */
        .input-group {
            background-color: var(--unh-white);
            border-radius: 2rem;
            padding: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Text input field styling, with padding and transparent background */
        #user-input {
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            background: transparent;
        }

        /* Remove shadow on focus for a cleaner look */
        #user-input:focus {
            box-shadow: none;
        }
        
        /* Send button styling, circular with blue background, centered icon, and hover effect */
        #send-button {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: #0b5ed7; 
            color: var(--btn-text);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            margin-right: 0.5rem;
        }
        #uploadButton {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: #0b5ed7; 
            color: var(--btn-text);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            margin-right: 0.5rem;
        }
        
        /* Hover effect for send button with slight scale animation */
        #send-button:hover {
            background-color: #0b5ed7;
            transform: scale(1.05);
        }

        /* Edit button styling, positioned at the top-right of its container with a semi-transparent background */
        .edit-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--unh-black);
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        /* Hover effect for edit button with increased background opacity */
        .edit-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        /* Custom Scrollbar */
        .chat-history::-webkit-scrollbar {
            width: 8px;
        }

        .chat-history::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        .chat-history::-webkit-scrollbar-thumb {
            background: rgba(0, 53, 145, 0.5);
            border-radius: 4px;
        }

        .chat-history::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 53, 145, 0.7);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            font-size: 1rem;
            color: #666;
            margin-top: 10px;
        }

        .typing-indicator .dot {
            width: 8px;
            height: 8px;
            background-color: #666;
            border-radius: 50%;
            margin: 0 2px;
            animation: blink 1s infinite alternate;
        }

        .typing-indicator .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes blink {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        @media (max-width: 768px) {
            .chat-container {
                margin: 0;
                border-radius: 0;
            }

            .message {
                max-width: 85%;
            }

            .chat-header {
                padding: 0.75rem;
                height: 70px;
            }

            .chat-header img {
                height: 60px;
            }

            .chat-header-title {
                font-size: 1.2rem;
            }
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        /* Container */
        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        /* Drag & Drop Upload Box */
        .upload-area {
            border: 2px dashed #007bff;
            padding: 30px;
            cursor: pointer;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 20px;
            background-color: #eaf4ff;
            transition: background 0.3s ease;
        }

        .upload-area:hover {
            background: #d6ebff;
        }

        .upload-area.dragover {
            background: #c2e0ff;
            border-color: #0056b3;
        }

        /* Hidden Input File */
        #fileInput {
            display: none;
        }

        /* File Name Display */
        .file-info {
            margin-top: 10px;
            font-size: 16px;
            color: #007bff;
        }

        /* Button Container */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        /* Modern Button Styles */
        .modern-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            font-size: 16px;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
        }

        /* Zoom-In Effect on Hover */
        .modern-btn:hover {
            transform: scale(1.2);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        /* Ripple Effect on Click */
        .modern-btn:active::after {
            content: "";
            position: absolute;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.3);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            animation: ripple 0.5s ease-out;
        }

        @keyframes ripple {
            from {
                width: 0;
                height: 0;
                opacity: 1;
            }
            to {
                width: 200%;
                height: 200%;
                opacity: 0;
            }
            
        }/* Microphone Button Styling */
#mic-button {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background-color: #0b5ed7;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    margin-right: 0.5rem;
}

#mic-button:hover {
    background-color: #003f8a;
    transform: scale(1.1);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

#mic-button i {
    font-size: 18px;
}

        
    </style>
</head>
<body>
    <div class="page-container">
        <div class="container-fluid h-100 p-0">
            <div class="row h-100 m-0">
                <div class="col-12 p-0">
                    <div class="chat-container">
                        <div class="chat-header">
                            <div class="header-content">
                                <h1 class="chat-header-title">NECHE Syllabus Assistant
 </h1>
                            <!-- Additional Logo -->
                        </div>
                    </div>
                    
                        <div class="chat-history" id="chat-history">
                            <!-- Chat messages will be inserted here -->
                        </div>
                        <div class="input-area">
                            <div class="input-group">
                                <button id="uploadButton" class="plus-icon">+</button>
                                <input type="file" id="fileInput" accept=".pdf, .docx" style="display: none;">
                                
                                <!-- Microphone Button for Voice Input -->
                                <button id="mic-button" class="btn btn-primary">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                
                                <input type="text" id="user-input" class="form-control" placeholder="Type your text here...">
                                <button id="send-button" class="btn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h2 style="text-align: center; font-weight: bold; margin-bottom: 20px;">NECHE Requirement List</h2>

    <div id="reportButtons" style="display: none; text-align: center; margin-top: 20px;">
        <button id="viewReport" class="btn btn-primary">View Report</button>
        <button id="downloadReport" class="btn btn-success">Download Report</button>
    </div>
    table style="width: 100%; border-collapse: collapse; font-size: 16px; text-align: left; background: white; box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1); border-radius: 8px; overflow: hidden;">
        <thead>
            <tr style="background-color: #3a17d8; color: white; text-align: center;">
                <th style="padding: 15px; border: 1px solid #ddd; width: 40%;">Requirement</th>
                <th style="padding: 15px; border: 1px solid #ddd; width: 60%;">Details</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Instructor Name</td>
                <td style="padding: 14px; border: 1px solid #ddd;">Phillip Deen</td>
            </tr>
            
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Title or Rank</td>
                <td style="padding: 14px; border: 1px solid #ddd;">Senior Lecturer of Philosophy & Humanities</td>
            </tr>
    
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Department or Program Affiliation</td>
                <td style="padding: 14px; border: 1px solid #ddd; color: red; font-weight: bold;">Not Found</td>
            </tr>
    
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Preferred Contact Method</td>
                <td style="padding: 14px; border: 1px solid #ddd;">E-mail</td>
            </tr>
    
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Professor's Email Address</td>
                <td style="padding: 14px; border: 1px solid #ddd;">phillip.deen@unh.edu</td>
            </tr>
    
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Professor's Phone Number</td>
                <td style="padding: 14px; border: 1px solid #ddd; color: red; font-weight: bold;">Not Found</td>
            </tr>
    
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Office Address</td>
                <td style="padding: 14px; border: 1px solid #ddd;">431</td>
            </tr>
    
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Office Hours</td>
                <td style="padding: 14px; border: 1px solid #ddd;">Tuesdays and Thursdays before 10:00 or after class at 3:00</td>
            </tr>
    
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Location (Physical or Remote)</td>
                <td style="padding: 14px; border: 1px solid #ddd;">Classroom 345</td>
            </tr>
    
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Course Learning Outcomes</td>
                <td style="padding: 14px; border: 1px solid #ddd;">
                    Gain knowledge about the texts and culture of classical Greece, engage deeply with 
                    general questions of aesthetics, politics, metaphysics, and the nature of a good life, 
                    learn how to read and think critically.
                </td>
            </tr>
    
            <tr>
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Credit Hour Workload</td>
                <td style="padding: 14px; border: 1px solid #ddd; color: red; font-weight: bold;">Not Found</td>
            </tr>
    
            <tr style="background-color: #f9f9f9;">
                <td style="padding: 14px; border: 1px solid #ddd; font-weight: bold;">Grading Procedures & Final Grade Scale</td>
                <td style="padding: 14px; border: 1px solid #ddd;">
                    A: 93.3+, A-: 90.0-93.2, B+: 86.6-89.9, B: 83.3-86.5, B-: 80.0-83.2, 
                    C+: 76.6-79.9, C: 73.3-76.5, C-: 70.0-73.2, D+: 66.6-69.9, 
                    D: 63.3-66.5, D-: 60.0-63.2, F: 0-59.9
                </td>
            </tr>
        </tbody>
    </table>
    <!-- Voice Assitant -->
    <div class="page-container">
        <div class="container-fluid h-100 p-0">
            <div class="row h-100 m-0">
                <div class="col-12 p-0">
                    <div class="chat-container">
                        <div class="chat-header">
                            <h1 class="chat-header-title">NECHE Syllabus Assistant</h1>
                        </div>
                        <div class="chat-history" id="chat-history">
                            <!-- Chat messages will be inserted here -->
                        </div>
                        <div class="input-area">
                            <div class="input-group">
                                <!-- Microphone Button for Voice Input -->
                                <button id="mic-button" class="btn btn-primary">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <input type="text" id="user-input" class="form-control" placeholder="Type your text here...">
                                <button id="send-button" class="btn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.21/jspdf.plugin.autotable.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const chatHistory = document.getElementById("chat-history");
        const userInput = document.getElementById("user-input");
        const sendButton = document.getElementById("send-button");
        const fileInput = document.getElementById("fileInput");
        const uploadButton = document.getElementById("uploadButton");
        const micButton = document.getElementById("mic-button"); // Voice Assistant Button

        let latestReportData = null;

        function displayWelcomeMessage() {
            addHTMLMessage("Welcome! I can assist with NECHE compliance. How can I help you today?", false);
        }
        window.addEventListener("load", displayWelcomeMessage);

        function addHTMLMessage(htmlContent, isUser) {
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("message", isUser ? "user-message" : "assistant-message");

            const chatIcon = document.createElement("div");
            chatIcon.classList.add("message-avatar");
            chatIcon.innerHTML = isUser ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';

            const messageContent = document.createElement("div");
            messageContent.classList.add("message-content");
            messageContent.innerHTML = htmlContent;

            messageDiv.appendChild(chatIcon);
            messageDiv.appendChild(messageContent);

            chatHistory.appendChild(messageDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        sendButton.addEventListener("click", handleSend);
        userInput.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                handleSend();
            }
        });

        micButton.addEventListener("click", handleVoiceInput); // Voice Assistant Event Listener

        function handleSend() {
            const message = userInput.value.trim();
            if (!message) return;

            addHTMLMessage(message, true);
            userInput.value = "";

            fetch("/ask", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message }),
            })
            .then(response => response.json())
            .then(data => {
                const userMessage = message.toLowerCase().trim();

                const casualGreetings = {
                    "hi": "Hey! This is NECHE Compliance Assistant. How can I help you?",
                    "hello": "Hello! How can I assist you today?",
                    "hey": "Hey there! Need help with NECHE syllabus compliance?",
                    "what's up": "Not much, just assisting with NECHE compliance. What‚Äôs up with you?",
                    "how are you": "I'm great! Thanks for asking. How can I help you?"
                };

                if (casualGreetings[userMessage]) {
                    addHTMLMessage(casualGreetings[userMessage], false);
                } else {
                    addHTMLMessage(data.response, false);
                }
            })
            .catch(() => addHTMLMessage("‚ö†Ô∏è Error: Unable to communicate with the server.", false));
        }

        function handleVoiceInput() {
            if (!('webkitSpeechRecognition' in window)) {
                alert("Sorry, your browser does not support voice recognition.");
                return;
            }

            const recognition = new webkitSpeechRecognition();
            recognition.lang = "en-US";
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onstart = () => {
                addHTMLMessage("üé§ Listening...", false);
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                userInput.value = transcript;
                handleSend(); // Directly send the recognized message
            };

            recognition.onerror = (event) => {
                addHTMLMessage("‚ö†Ô∏è Voice recognition error. Please try again.", false);
            };

            recognition.onend = () => {
                console.log("Voice recognition ended.");
            };

            recognition.start();
        }

        uploadButton.addEventListener("click", function () {
            fileInput.click();
        });

    // Handle file upload
    function handleFileUpload(file) {
        const formData = new FormData();
        formData.append('file', file);

        addMessage('‚è≥ Processing PDF file...', false);

        fetch('/upload', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            return response.json().catch(() => {
                throw new Error("‚ùå Server response is not valid JSON. Check Flask error logs.");
            });
        })
        .then(data => {
            if (data.success) {
                // ‚úÖ Display Extracted Information
                if (data.extracted_information) {
                    let extractedInfo = data.extracted_information;

                    const requiredOrder = [
                    "Instructor Name", "Title or Rank", "Department or Program Affiliation",
            "Preferred Contact Method", "Professor's Email Address", "Professor's Phone Number",
            "Office Address", "Office Hours", "Location (Physical or Remote)",
            "Course SLOs", "Program SLOs", "Credit Hour Workload", "Assignments & Delivery",
            "Grading Procedures & Final Grade Scale", "Assignment Deadlines & Policies"
                ];

                    let infoHTML = `<h2 style="text-align: center; font-weight: bold; margin-bottom: 20px;"></h2>
                                    <div style="display: flex; flex-direction: column; gap: 10px; padding: 10px;">`;

                    requiredOrder.forEach((key) => {
                        if (extractedInfo.hasOwnProperty(key)) {
                            infoHTML += `
                                <div style="display: flex; justify-content: space-between; border-bottom: 1px solid #ddd; padding: 8px 0;">
                                    <strong style="width: 40%; text-align: left;">${key}:</strong>
                                    <span style="width: 60%; text-align: left;">${extractedInfo[key] || "Not Found"}</span>
                                </div>`;
                        }
                    });

                    infoHTML += `</div>`;
                    addHTMLMessage(infoHTML, false); // ‚úÖ Display extracted info
                }

                // ‚úÖ Display NECHE Compliance Status
                addMessage(`NECHE Compliance Check: ${data.compliance_check}`, false);
            } else {
                throw new Error(`‚ùå Upload failed: ${data.error}`);
            }
        })
        .catch(error => {
            console.error("‚ùå Error:", error.message);
            addMessage(`‚ö†Ô∏è ${error.message}`, false);
        });
    }

        function displayReportOptions() {
            const reportContainer = document.createElement("div");
            reportContainer.style.marginTop = "15px";
            reportContainer.style.textAlign = "left";

            const viewButton = createStyledButton("View Report", "btn btn-info", showReportModal);
            const downloadButton = createStyledButton("Download Report", "btn btn-success", downloadReport);

            reportContainer.appendChild(viewButton);
            reportContainer.appendChild(downloadButton);
            chatHistory.appendChild(reportContainer);
        }

        function createStyledButton(text, classes, clickHandler) {
            const button = document.createElement("button");
            button.textContent = text;
            button.className = `${classes} modern-btn`;
            button.style.margin = "10px";
            button.addEventListener("click", clickHandler);
            return button;
        }

        function showReportModal() {
            if (!latestReportData) {
                addHTMLMessage("No report available.", false);
                return;
            }

            const requiredOrder = [
                "Instructor Name", "Title or Rank", "Department or Program Affiliation",
                "Preferred Contact Method", "Email Address", "Phone Number",
                "Office Address", "Office Hours", "Location (Physical or Remote)",
                "Course Learning Outcomes", "Credit Hour Workload", "Coursework Types & Submission Methods",
                "Grading Procedures & Final Grade Scale", "Assignment Deadlines & Policies"
            ];

            let reportContent = `<table class="table table-bordered">
                <thead>
                    <tr style="background-color: #3a17d8; color: white; text-align: center;">
                        <th style="padding: 15px; width: 40%;">Requirement</th>
                        <th style="padding: 15px; width: 60%;">Details</th>
                    </tr>
                </thead>
                <tbody>`;

            requiredOrder.forEach(key => {
                let value = latestReportData[key] || "Not Found";
                if (value === "Not Found") {
                    value = `<strong style="color: red;">${value}</strong>`;
                }
                reportContent += `<tr><td style="padding: 14px;">${key}</td><td style="padding: 14px;">${value}</td></tr>`;
            });

            reportContent += `</tbody></table>`;
            addHTMLMessage(reportContent, false);
        }

        function downloadReport() {
            if (!latestReportData) {
                alert("No report available to download.");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(16);
            doc.text("NECHE Compliance Report", 14, 20);

            const tableColumn = ["Requirement", "Details"];
            const tableRows = [];

            const requiredOrder = [
                "Instructor Name", "Title or Rank", "Department or Program Affiliation",
                "Preferred Contact Method", "Email Address", "Phone Number",
                "Office Address", "Office Hours", "Location (Physical or Remote)",
                "Course Learning Outcomes", "Credit Hour Workload", "Coursework Types & Submission Methods",
                "Grading Procedures & Final Grade Scale", "Assignment Deadlines & Policies"
            ];

            requiredOrder.forEach(key => {
                let value = latestReportData[key] || "Not Found";
                tableRows.push([key, value]);
            });

            doc.autoTable({
                startY: 30,
                head: [tableColumn],
                body: tableRows,
                theme: "grid",
                headStyles: { fillColor: [58, 23, 216] },
                styles: { fontSize: 10, cellPadding: 4 },
            });

            doc.save("NECHE_Compliance_Report.pdf");
        }
    });
</script>

    
    </script>
    
</body>
</html>